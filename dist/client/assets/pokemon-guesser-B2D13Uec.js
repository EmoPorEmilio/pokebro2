import{g as v,t as h,i as N,c as i,S as b,a as Pe,s as pe,u as de,b as s,d as Q,e as T,o as fe,f as ke,h as z}from"./main-CTqC90n7.js";import{G as r,H as Ee,O as Ie,Y as ve,a as be,D as he,C as Le,T as w,M as Oe}from"./YouLose-D20lCai3.js";import{b as _e,c as Te,r as we,E as Ne,g as ye,p as Ae}from"./utils-DnYjgxtT.js";var $e=h('<img width=210 height=210 alt="pokemon sprite"class=object-contain>'),xe=h('<div class="flex flex-col w-full py-10 px-10 justify-center items-center"><div class="flex flex-col w-full h-full items-center justify-center rounded-xl border border-primary-600 border-b-2 border-b-accent-500 bg-bg-300">'),Fe=h('<div class="w-[210px] h-[210px] rounded-xl animate-pulse bg-bg-light">');function Ve(o){return(()=>{var l=v(xe),n=l.firstChild;return N(n,i(b,{get when(){return!o.loading},get fallback(){return v(Fe)},get children(){return i(b,{get when(){return o.pokemonSrc},get children(){var d=v($e);return Pe(()=>pe(d,"src",o.pokemonSrc)),d}})}})),l})()}const p={all:["pokemon"],info:o=>[...p.all,"info",o],image:o=>[...p.all,"image",o],batch:o=>[...p.all,"batch",o.join(",")]},Ce="https://pokeapi.co/api/v2",Ue="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon";async function He(o){const l=await fetch(`${Ce}/pokemon-species/${o}`);if(!l.ok)throw new Error(`Failed to fetch pokemon ${o}`);const n=await l.json();return{number:o,name:Te(n.name)}}async function Me(o){const l=await fetch(`${Ue}/${o}.png`);if(!l.ok)throw new Error(`Failed to fetch image for pokemon ${o}`);const n=await l.blob();return _e(n)}async function Ge(o){return(await Promise.all(o.map(async n=>{try{return await He(n)}catch{return null}}))).filter(n=>n!==null)}var De=h('<div class="flex flex-col h-[100dvh] w-[100dvw] bg-bg-400 antialiased"><!$><!/><!$><!/>');function Ye(){const o=de(),n=typeof window>"u"?{availablePokes:[],scorePoints:"000",HP:3,currentPokemon:null,currentPokemonSrc:null,pokemonNameOptions:[],level:0,gameState:r.LEVEL_SETUP,timer:w}:{availablePokes:JSON.parse(localStorage.getItem("availablePokes")??"[]"),scorePoints:localStorage.getItem("scorePoints")??"000",HP:parseInt(localStorage.getItem("HP")??"3"),currentPokemon:JSON.parse(localStorage.getItem("currentPokemon")??"null"),currentPokemonSrc:localStorage.getItem("currentPokemonSrc")??null,pokemonNameOptions:JSON.parse(localStorage.getItem("pokemonNameOptions")??"[]"),level:parseInt(localStorage.getItem("level")??"0"),gameState:localStorage.getItem("gameState")??r.LEVEL_SETUP,timer:parseInt(localStorage.getItem("timer")??String(w))},[d,y]=s(n.timer),[A,$]=s(n.HP),[L,x]=s(n.scorePoints),[F,V]=s(n.level),[m,u]=s(n.gameState),[C,U]=s(""),[H,O]=s(n.availablePokes),[M,G]=s(n.currentPokemon),[X,D]=s(n.currentPokemonSrc),[W,R]=s(n.pokemonNameOptions),[g,_]=s([]),[Z,ee]=s(null);let S=null;const f=Q(()=>({queryKey:p.batch(g()),queryFn:()=>Ge(g()),staleTime:1/0,gcTime:1e3*60*60,enabled:g().length>0&&m()===r.LEVEL_SETUP,retry:3})),k=Q(()=>({queryKey:p.image(g()[0]??0),queryFn:()=>Me(g()[0]),staleTime:1/0,gcTime:1e3*60*60,enabled:g().length>0&&m()===r.LEVEL_SETUP,retry:3})),te=()=>{o({to:"/"})},oe=()=>{m()===r.VALIDATION&&(J(),u(r.LEVEL_SETUP),localStorage.setItem("gameState",r.LEVEL_SETUP))},ne=t=>{var e;V(a=>{const c=a+1;return localStorage.setItem("level",String(c)),c}),((e=M())==null?void 0:e.name)===t.name?re():(Y(),ae())},re=()=>{J(),x(t=>{const e=Ae(parseInt(t)+1);return localStorage.setItem("scorePoints",e),e}),u(r.LEVEL_SETUP)},K=()=>{S&&clearInterval(S),u(r.YOU_LOSE)},ae=()=>{$(t=>{const e=t-1;return localStorage.setItem("HP",String(e)),e===0?K():u(r.VALIDATION),e})},se=()=>{V(0),$(3),y(w),j(),x("000"),O([]),_([]),u(r.LEVEL_SETUP)},le=t=>{const e=t?ge():H(),{randomPokemonNumbers:a,indexToRemove:c}=ye(e,5);_(a),ee(c),t&&O(e)},ce=(t,e,a,c)=>{localStorage.setItem("availablePokes",JSON.stringify(t)),localStorage.setItem("scorePoints",L()),localStorage.setItem("HP",String(A())),localStorage.setItem("currentPokemon",JSON.stringify(e)),localStorage.setItem("currentPokemonSrc",a),localStorage.setItem("pokemonNameOptions",JSON.stringify(c)),localStorage.setItem("level",String(F())),localStorage.setItem("gameState",r.LEVEL_INFO)},J=()=>{G(null),D(null),R([]),_([])},Y=()=>{localStorage.removeItem("gameState"),localStorage.removeItem("currentPokemon"),localStorage.removeItem("currentPokemonSrc"),localStorage.removeItem("pokemonNameOptions")},ie=()=>{localStorage.removeItem("availablePokes"),localStorage.removeItem("scorePoints"),localStorage.removeItem("HP"),Y(),localStorage.removeItem("level"),localStorage.removeItem("timer")},me=(t,e)=>{const a=[...t];return a.splice(e,1),O(a),a},ge=()=>{const t=[];for(let e=1;e<=Oe;e++)t.push(e);return t},ue=()=>{y(t=>{const e=t-1;return e<=0?K():localStorage.setItem("timer",String(e)),e})},j=()=>{S=setInterval(ue,1e3)};T(()=>{const t=m();if(t===r.LEVEL_SETUP&&g().length===0){const e=F()===0;le(e)}else t===r.YOU_LOSE&&ie()}),T(()=>{const t=f.data,e=k.data,a=f.isSuccess,c=k.isSuccess;if(m()===r.LEVEL_SETUP&&a&&c&&t&&e&&t.length>=5){const E=t[0];G(E),D(e);const I=we(t);R(I);const P=Z();if(P!==null){const Se=me(H(),P);ce(Se,E,e,I)}u(r.LEVEL_INFO)}}),T(()=>{f.isError&&U("Failed to load Pokemon data. Please refresh and try again."),k.isError&&U("Failed to load Pokemon image. Please refresh and try again.")}),fe(()=>{j()}),ke(()=>{S&&clearInterval(S)});const q=()=>m()===r.LEVEL_SETUP||f.isPending||k.isPending;return(()=>{var t=v(De),e=t.firstChild,[a,c]=z(e.nextSibling),B=a.nextSibling,[E,I]=z(B.nextSibling);return N(t,i(Ee,{handleHeaderBack:te,inGame:!0,get HP(){return A()},get scorePoints(){return L()},get timer(){return d()}}),a,c),N(t,i(Le,{onClick:oe,get children(){return i(b,{get when(){return m()!==r.YOU_LOSE},get fallback(){return i(ve,{get scorePoints(){return L()},get difficulty(){return he.HARD},get gameMode(){return be.POKEMON_GUESSER},restartGame:se})},get children(){return i(b,{get when(){return!C()},get fallback(){return i(Ne,{get message(){return C()}})},get children(){return[i(Ve,{get loading(){return q()},get pokemonSrc(){return X()}}),i(Ie,{get correctNameOption(){var P;return(P=M())==null?void 0:P.name},get validation(){return m()===r.VALIDATION},get loading(){return q()},handleClickOption:ne,get pokemonNameOptions(){return W()}})]}})}})}}),E,I),t})()}export{Ye as component};
